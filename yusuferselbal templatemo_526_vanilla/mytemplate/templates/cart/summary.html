{% extends 'base.html' %}
{% load static %}
{% block title %} Cart {% endblock title %}

{% block content %}

<link rel="stylesheet" href={% static 'website/css/cart.css' %}>

<section class="h-100 h-custom" style="background-color: #eee;">
    <div class="container py-5 h-100">
      <div class="row d-flex justify-content-center align-items-center h-100">
        <div class="col">
          <div class="card">
            <div class="card-body p-4">
  
              <div class="row">
  
                <div class="col-lg-7">
                  <h5 class="mb-3"><a href="{% url 'website:portfolio' %}" class="text-body"><i
                        class="fas fa-long-arrow-alt-left me-2"></i>Continue Shopping</a></h5>
                  <hr>
  
                  <div class="d-flex justify-content-between align-items-center mb-4">
                    <div>
                      <p class="mb-1">Shopping cart</p>
                      <p class="mb-0">
                      {% with totalQty=cart|length %}
                      You have
                      <span id="summary-qty">
                      {% if totalQty > 0 %}
                      {{ totalQty }}
                      {% else %}
                      0
                      {% endif %}
                      </span>
                      items in your cart
                      </p>
                      {% endwith %}
                    </div>
                  </div>

                  {% for item in cart %}
                  {% with service=item.service %}

                  <div data-index="{{ service.id }}" class="card mb-3 service-cart">
                    <div class="card-body">
                      <div class="d-flex justify-content-between">
                        <div class="d-flex flex-row align-items-center">
                          <div>
                            <a href="{{ service.get_absolute_url }}">
                              <img src="{{ service.image.url }}" class="img-fluid rounded-3" alt="Shopping Item" style="width: 65px;">
                            <a/>
                          </div>
                          <div class="ms-3">
                            <h5><a href="{{ service.get_absolute_url }}">{{ service.name }}<a/></h5> 
                            <p class="small mb-0">{{ service.description }}</p>
                          </div>
                        </div>
                        <div class="d-flex flex-row align-items-center">
                          <div style="width: 50px;">
                            <h5 class="fw-normal mb-2"><input id="service-qty-{{ service.id }}" type="number" min="1" name="someid" value="{{ item.qty }}" style="width: 50px;"/></h5>
                          </div>
                          <div style="width: 80px;">
                            <h5 id="item-price" class="mb-0">₺ {{ service.price }}</h5>
                          </div>
                            <a class="update-btn me-2" style="color: #cecece;" data-index="{{ service.id }}"><i class="fas fa-refresh" style="cursor: pointer; "></i></a>
                            <a class="delete-btn" style="color: #cecece;" data-index="{{ service.id }}"><i class="fas fa-trash-alt" style="cursor: pointer; "></i></a>
                        </div>
                      </div>
                    </div>
                  </div>

                  {% endwith %}
                  {% endfor %}                        
  
                </div>
                <div class="col-lg-5">
  
                  <div class="card bg-primary text-white rounded-3">
                    <div class="card-body">
                      <div class="d-flex justify-content-between align-items-center mb-4">
                        <h5 class="mb-0">Card Details</h5>
                      </div>
  
                      <p class="small mb-2">Card Type</p>
                      <a href="#!" type="submit" class="text-white"><i
                          class="fab fa-cc-mastercard fa-2x me-2"></i></a>
                      <a href="#!" type="submit" class="text-white"><i
                          class="fab fa-cc-visa fa-2x me-2"></i></a>
                      <a href="#!" type="submit" class="text-white"><i
                          class="fab fa-cc-amex fa-2x me-2"></i></a>
                      <a href="#!" type="submit" class="text-white"><i 
                          class="fab fa-cc-paypal fa-2x"></i></a>
  
                      <form class="mt-4">
                        <div class="form-outline form-white mb-4">
                          <input type="text" id="typeName" class="form-control form-control-lg" siez="17"
                            placeholder="Cardholder's Name" />
                          <label class="form-label" for="typeName">Cardholder's Name</label>
                        </div>
  
                        <div class="form-outline form-white mb-4">
                          <input type="text" id="typeText" class="form-control form-control-lg" siez="17"
                            placeholder="1234 5678 9012 3457" minlength="19" maxlength="19" />
                          <label class="form-label" for="typeText">Card Number</label>
                        </div>
  
                        <div class="row mb-4">
                          <div class="col-md-6">
                            <div class="form-outline form-white">
                              <input type="text" id="typeExp" class="form-control form-control-lg"
                                placeholder="MM/YYYY" size="7" id="exp" minlength="7" maxlength="7" />
                              <label class="form-label" for="typeExp">Expiration</label>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-outline form-white">
                              <input type="password" id="typeText" class="form-control form-control-lg"
                                placeholder="&#9679;&#9679;&#9679;" size="1" minlength="3" maxlength="3" />
                              <label class="form-label" for="typeText">Cvv</label>
                            </div>
                          </div>
                        </div>
  
                      </form>
  
                      <hr class="my-4">
  
                      <div class="d-flex justify-content-between">
                        <p class="mb-2">Subtotal</p>
                        <p id="subtotal" class="mb-2">₺ {{ cart.cartTotal }}</p>
                      </div>

                      <br/> <br/> <br/>
  
                      <button type="button" class="btn btn-info btn-block btn-lg">
                        <div class="d-flex justify-content-between">
                          <span>Checkout<i class="fas fa-long-arrow-alt-right ms-2"></i></span>
                        </div>
                      </button>
  
                    </div>
                  </div>
  
                </div>
  
              </div>
  
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

<script>

    //Delete
    $(document).on('click', '.delete-btn', function (e) {
        e.preventDefault();
        var srvID = $(this).data('index');
        $.ajax({
            type: 'POST',
            url: '{% url "cart:cartDelete" %}',
            data: {
                serviceid: $(this).data('index'),
                csrfmiddlewaretoken: '{{ csrf_token }}',
                action: 'post',
            },
            success: function (json) {
              $('.service-cart[data-index="' + srvID + '"]').remove();
              document.getElementById("cart-qty").innerHTML = json.qty;
              document.getElementById("summary-qty").innerHTML = json.qty;
              document.getElementById("subtotal").innerHTML = "₺" + json.subtotal;
            },
            error: function (xhr, errmsg, err) {}
        });
    });

    //Update
    $(document).on('click', '.update-btn', function (e) {
      e.preventDefault();
      var srvID = $(this).data('index');
      $.ajax({
          type: 'POST',
          url: '{% url "cart:cartUpdate" %}',
          data: {
              serviceid: $(this).data('index'),
              serviceqty: $('#service-qty-' + srvID).val(),
              csrfmiddlewaretoken: '{{ csrf_token }}',
              action: 'post',
          },
          success: function (json) {
            document.getElementById("cart-qty").innerHTML = json.qty; //Side Navbar Quantity
            document.getElementById("summary-qty").innerHTML = json.qty; //Cart Quantity
            document.getElementById("subtotal").innerHTML = "₺" + json.subtotal; //Subtotal Text
            //document.getElementById("item-price").innerHTML = "₺";
          },
          error: function (xhr, errmsg, err) {}
      });
  });

</script>

{% endblock content %}